# Lead Parser (Telegram + Facebook)

–ü–∞—Ä—Å–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ Telegram —á–∞—Ç–æ–≤ –∏ Facebook –≥—Ä—É–ø–ø –¥–ª—è –ø–æ–∏—Å–∫–∞ –ª–∏–¥–æ–≤ –Ω–∞ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å –∏ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç —Å –∞–Ω–∞–ª–∏–∑–æ–º —á–µ—Ä–µ–∑ Gemini AI.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### Telegram
- üì¨ –ü–∞—Ä—Å–∏–Ω–≥ —á–∞—Ç–æ–≤ –∏–∑ –ø–∞–ø–∫–∏ Telegram Desktop (–≤–∫–ª—é—á–∞—è —Ç–æ–ø–∏–∫–∏)
- üîç –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ exclude-—Å–ª–æ–≤–∞–º
- ü§ñ Batch-–∞–Ω–∞–ª–∏–∑ —á–µ—Ä–µ–∑ Gemini AI

### Facebook
- üìò –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–±–æ—Ä –≤—Å–µ—Ö –≥—Ä—É–ø–ø –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- üîÑ –ü–∞—Ä—Å–∏–Ω–≥ –Ω–æ–≤—ã—Ö –ø–æ—Å—Ç–æ–≤ (–æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø–æ –≤—Ä–µ–º–µ–Ω–∏)
- üïµÔ∏è Stealth mode –¥–ª—è –æ–±—Ö–æ–¥–∞ –¥–µ—Ç–µ–∫—Ü–∏–∏
- üîó –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É Chrome —á–µ—Ä–µ–∑ CDP

### –û–±—â–µ–µ
- üè† –ü–æ–∏—Å–∫ –ª–∏–¥–æ–≤ –Ω–∞ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å (–∞—Ä–µ–Ω–¥–∞/–ø–æ–∫—É–ø–∫–∞)
- üöó –ü–æ–∏—Å–∫ –ª–∏–¥–æ–≤ –Ω–∞ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç (–∞—Ä–µ–Ω–¥–∞)
- üìä Confidence score –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- üéØ –û—Ç–ø—Ä–∞–≤–∫–∞ –ª–∏–¥–æ–≤ –≤ Telegram –±–æ—Ç

---

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ü–æ–ª—É—á–∏—Ç—å API –∫–ª—é—á–∏

| –°–µ—Ä–≤–∏—Å | –ì–¥–µ –ø–æ–ª—É—á–∏—Ç—å |
|--------|--------------|
| Telegram API | [my.telegram.org](https://my.telegram.org) ‚Üí API development tools |
| Bot Token | [@BotFather](https://t.me/BotFather) ‚Üí /newbot |
| Admin Chat ID | [@userinfobot](https://t.me/userinfobot) |
| Gemini API | [aistudio.google.com](https://aistudio.google.com/apikey) |

### 2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –æ–∫—Ä—É–∂–µ–Ω–∏–µ

```bash
cp .env.example .env
nano .env  # –∑–∞–ø–æ–ª–Ω–∏—Ç—å –∫–ª—é—á–∏
```

### 3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å config.yaml

```yaml
telegram:
  folder_name: "*"  # "*" = –≤—Å–µ –≥—Ä—É–ø–ø—ã, –∏–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø–∞–ø–∫–∏

facebook:
  enabled: true
  posts_per_group: 20
  scan_interval_minutes: 15

filter:
  exclude_words:
    - "—Ä–µ–∫–ª–∞–º–∞"
    - "—Å–ø–∞–º"
```

### 4. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è Telegram

```bash
docker-compose run --rm app python -m src.telegram.userbot --auth
```

---

## üîó –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Facebook (Chrome CDP)

Facebook —Å–∫—Ä–∞–ø–µ—Ä –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ **—É–∂–µ –∑–∞–ø—É—â–µ–Ω–Ω–æ–º—É Chrome** —á–µ—Ä–µ–∑ Chrome DevTools Protocol, –∏—Å–ø–æ–ª—å–∑—É—è –≤–∞—à—É –∞–∫—Ç–∏–≤–Ω—É—é —Å–µ—Å—Å–∏—é.

### –®–∞–≥ 1: –ó–∞–ø—É—Å—Ç–∏—Ç—å Chrome —Å CDP

```bash
# Linux
google-chrome --remote-debugging-port=9222

# macOS
/Applications/Google\ Chrome.app/Contents/MacOS/Google\ Chrome --remote-debugging-port=9222

# Windows
"C:\Program Files\Google\Chrome\Application\chrome.exe" --remote-debugging-port=9222
```

> ‚ö†Ô∏è **–í–∞–∂–Ω–æ:** Chrome –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–∫—Ä—ã—Ç –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º —Å —Ñ–ª–∞–≥–æ–º. –ï—Å–ª–∏ Chrome —É–∂–µ –∑–∞–ø—É—â–µ–Ω, –∑–∞–∫—Ä–æ–π—Ç–µ –≤—Å–µ –æ–∫–Ω–∞.

### –®–∞–≥ 2: –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è –≤ Facebook

1. –í –æ—Ç–∫—Ä—ã–≤—à–µ–º—Å—è Chrome –ø–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ [facebook.com](https://facebook.com)
2. –í–æ–π–¥–∏—Ç–µ –≤ —Å–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ [facebook.com/groups](https://facebook.com/groups) –∏ —É–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≥—Ä—É–ø–ø—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è

### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å .env

```bash
# –î–æ–±–∞–≤–∏—Ç—å –≤ .env
CHROME_CDP_URL=http://localhost:9222
```

**–î–ª—è Docker:** –ï—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ, –∞ Chrome –Ω–∞ —Ö–æ—Å—Ç–µ:
```bash
# Linux
CHROME_CDP_URL=http://172.17.0.1:9222

# macOS/Windows (Docker Desktop)
CHROME_CDP_URL=http://host.docker.internal:9222
```

### –®–∞–≥ 4: –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

```bash
docker-compose build && docker-compose up -d
docker-compose logs -f app
```

### –®–∞–≥ 5: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–û—Ç–ø—Ä–∞–≤—å—Ç–µ –±–æ—Ç—É –∫–æ–º–∞–Ω–¥—É `/scanfb` ‚Äî –¥–æ–ª–∂–Ω–æ –Ω–∞—á–∞—Ç—å—Å—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ Facebook –≥—Ä—É–ø–ø.

---

## –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `/start` | –ü–æ–∫–∞–∑–∞—Ç—å –∫–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è |
| `/scan` | –°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å Telegram |
| `/scanfb` | –°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å Facebook |
| `/pause` / `/pausefb` | –ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∞–≤—Ç–æ-—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ |
| `/resume` / `/resumefb` | –í–æ–∑–æ–±–Ω–æ–≤–∏—Ç—å |
| `/status` | –°—Ç–∞—Ç—É—Å –æ–±–æ–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ |

---

## –§–æ—Ä–º–∞—Ç –ª–∏–¥–æ–≤

### Telegram –ª–∏–¥
```
üè† –ù–æ–≤—ã–π –ª–∏–¥! (85%)
üìã –¢–∏–ø: –ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å

üë§ –ö–æ–Ω—Ç–∞–∫—Ç: @username
üí¨ –ß–∞—Ç: Pattaya Real Estate
üìù –°–æ–æ–±—â–µ–Ω–∏–µ:
Looking for 1BR condo near beach...

üí° –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏—â–µ—Ç –∫–æ–Ω–¥–æ –≤ –∞—Ä–µ–Ω–¥—É
```

### Facebook –ª–∏–¥
```
üìò üè† Facebook –ª–∏–¥! (80%)
üìã –¢–∏–ø: –ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å

üë§ –ê–≤—Ç–æ—Ä: John Smith
üí¨ –ì—Ä—É–ø–ø–∞: Pattaya Condos
üìù –ü–æ—Å—Ç:
Hi, I need a condo for 1 month...

üí° –ò—â–µ—Ç –∫—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—É—é –∞—Ä–µ–Ω–¥—É
```

---

## Docker –∫–æ–º–∞–Ω–¥—ã

```bash
# –ó–∞–ø—É—Å–∫
docker-compose up -d

# –õ–æ–≥–∏
docker-compose logs -f app

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
docker-compose down

# –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞
docker-compose build && docker-compose up -d
```

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
leads-tg/
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ config.yaml              # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Telegram, Facebook, —Ñ–∏–ª—å—Ç—Ä—ã
‚îú‚îÄ‚îÄ .env                     # API –∫–ª—é—á–∏
‚îî‚îÄ‚îÄ src/
    ‚îú‚îÄ‚îÄ main.py              # Entry point + –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫
    ‚îú‚îÄ‚îÄ telegram/
    ‚îÇ   ‚îú‚îÄ‚îÄ userbot.py       # –ü–∞—Ä—Å–∏–Ω–≥ Telegram —á–∞—Ç–æ–≤
    ‚îÇ   ‚îî‚îÄ‚îÄ bot.py           # –û—Ç–ø—Ä–∞–≤–∫–∞ –ª–∏–¥–æ–≤ + –∫–æ–º–∞–Ω–¥—ã
    ‚îú‚îÄ‚îÄ facebook/
    ‚îÇ   ‚îî‚îÄ‚îÄ scraper.py       # Playwright + CDP —Å–∫—Ä–∞–ø–µ—Ä
    ‚îú‚îÄ‚îÄ processing/
    ‚îÇ   ‚îú‚îÄ‚îÄ filter.py        # –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è exclude words
    ‚îÇ   ‚îî‚îÄ‚îÄ analyzer.py      # Gemini AI –∞–Ω–∞–ª–∏–∑
    ‚îî‚îÄ‚îÄ db/
        ‚îú‚îÄ‚îÄ models.py        # PostgreSQL –º–æ–¥–µ–ª–∏
        ‚îî‚îÄ‚îÄ repository.py    # CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏
```

---

## Troubleshooting

### Facebook scraper –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è

```
Facebook scraper failed to connect
```

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ Chrome –∑–∞–ø—É—â–µ–Ω —Å `--remote-debugging-port=9222`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –ø–æ—Ä—Ç –æ—Ç–∫—Ä—ã—Ç: `curl http://localhost:9222/json`
3. –î–ª—è Docker –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ö–æ—Å—Ç (`host.docker.internal` –∏–ª–∏ IP)

### –ù–µ—Ç –Ω–æ–≤—ã—Ö –ø–æ—Å—Ç–æ–≤

–°–∏—Å—Ç–µ–º–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è. –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ —Å–∫–∞–Ω–∏—Ä—É—é—Ç—Å—è –≤—Å–µ –ø–æ—Å—Ç—ã, –∑–∞—Ç–µ–º —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ.

–î–ª—è —Å–±—Ä–æ—Å–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –æ—á–∏—Å—Ç–∏—Ç–µ —Ç–∞–±–ª–∏—Ü—É `facebook_group_state` –≤ –ë–î.

---

## ‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

- **Facebook ToS:** –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –Ω–∞—Ä—É—à–∞–µ—Ç —É—Å–ª–æ–≤–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Facebook
- **–†–∏—Å–∫ –±–∞–Ω–∞:** –ê–∫–∫–∞—É–Ω—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω
- **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ—Ç–¥–µ–ª—å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç –¥–ª—è —Å–∫—Ä–∞–ø–∏–Ω–≥–∞
